document.addEventListener("DOMContentLoaded",function(e){if(document.querySelector('[data-page="account"]')){let o=document.querySelector('[data-input="wsql-account-firstname"]'),l=document.querySelector('[data-input="wsql-account-lastname"]'),s=document.querySelector('[data-input="wsql-account-email"]'),t=document.querySelector('[data-input="wsql-account-avatar"]'),a=document.querySelector('[data-button="wsql-account-save"]');function n(e,t){var a=document.createElement("input");a.type="text",a.className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-transparent",t&&(a.value=t),e.innerHTML="",e.appendChild(a)}(async()=>{var e=await(await fetch(users_me_endpoint,{method:"GET",headers:{"Content-Type":"application/json"}})).json();n(o,e.firstname),n(l,e.lastname),n(s,e.email),(async(e,t)=>{var t=t.trim().toLowerCase(),t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t)),t=(t=Array.from(new Uint8Array(t))).map(e=>e.toString(16).padStart(2,"0")).join(""),a=document.createElement("div"),n=(a.className="w-40 md:w-full h-40 md:h-full relative overflow-hidden shadow",document.createElement("img"));n.alt="Avatar",n.src=`https://gravatar.com/avatar/${t}?size=512&d=mp`,n.className="w-full h-full";(t=document.createElement("button")).type="button",t.className="absolute bottom-0 left-0 w-full h-12 bg-black bg-opacity-50 flex items-center justify-center gap-3 hover:bg-opacity-75 transition-colors",t.addEventListener("click",function(){window.open("https://gravatar.com/profile","_blank")});var o=document.createElement("span"),l=(o.className="text-white text-lg",o.textContent="Change Avatar",document.createElement("i"));l.className="fa-regular fa-image text-white text-lg",t.appendChild(l),t.appendChild(o),a.appendChild(n),a.appendChild(t),e.innerHTML="",e.appendChild(a)})(t,e.email),(async e=>{var t=document.createElement("button"),a=(t.type="button",t.className=wsql_standard_button,t.addEventListener("click",function(){(async e=>{e.querySelector("button").disabled=!0;var t=o.querySelector("input").value,a=l.querySelector("input").value,n=s.querySelector("input").value;(t=await fetch(users_me_endpoint,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:t,lastname:a,email:n})})).ok?WsqlToast.show("Your account was updated successfully","success",3e3):WsqlToast.show("An error occurred while updating your account","danger",3e3),e.querySelector("button").disabled=!1})(e)}),document.createElement("i")),n=(a.className="fa-regular fa-save",document.createElement("span"));n.textContent="Save",t.appendChild(a),t.appendChild(n),e.innerHTML="",e.appendChild(t)})(a)})()}if(document.querySelector('[data-component="wsql-account-updatePassword"]')){function t(e){var t=document.createElement("div"),a=document.createElement("p"),e=(a.className="block text-base font-medium text-gray-700 dark:text-white transition-all duration-300",a.textContent=e,t.appendChild(a),document.createElement("input"));return e.type="password",e.className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-transparent",t.appendChild(e),t}{var a=document.createElement("div");a.className="grid grid-cols-1 gap-5";let n=t("Current password"),o=(a.appendChild(n),t("New password")),l=(a.appendChild(o),t("Confirm new password"));a.appendChild(l);var s=document.createElement("div"),r=document.createElement("button"),i=(r.type="button",r.className="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-3 rounded-xl shadow-sm transition-all duration-100 cursor-pointer disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50",r.addEventListener("click",function(){var e=n.querySelector("input").value,t=o.querySelector("input").value,a=l.querySelector("input").value;e&&t&&a?e===t?WsqlToast.show("The new password cannot be the same as the current password","warning",3e3):t!==a?WsqlToast.show("The new password and confirm password do not match","danger",3e3):(async(e,t)=>{document.querySelector('[data-component="wsql-account-updatePassword"] button').disabled=!0;try{var a,n=await fetch(users_me_password_reset_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})});if(!n.ok)throw a=await n.json(),new Error(a.message);WsqlToast.show("Password updated successfully","success")}catch(e){WsqlToast.show(e.message,"danger")}document.querySelector('[data-component="wsql-account-updatePassword"] button').disabled=!1})(e,t):WsqlToast.show("Please fill in all fields","danger",3e3)}),document.createElement("i"));i.className="fa-regular fa-save",r.appendChild(i),(i=document.createElement("span")).textContent="Update",r.appendChild(i),s.appendChild(r),a.appendChild(s),document.querySelector('[data-component="wsql-account-updatePassword"]').innerHTML="",document.querySelector('[data-component="wsql-account-updatePassword"]').appendChild(a)}}}),document.addEventListener("DOMContentLoaded",()=>{var a=(e=>{var a=e+"=",n=document.cookie.split(";");for(let t=0;t<n.length;t++){let e=n[t];for(;" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(a))return e.substring(a.length,e.length)}return null})("cookieConsent");if("accepted"!==a&&("undefined"==typeof disableCookieBanner||!disableCookieBanner)){let e=document.createElement("div"),t=(e.className="fixed bottom-0 left-0 h-full w-full z-40 bg-black opacity-60",document.createElement("div"));t.className="fixed bottom-0 left-0 w-full z-50";var a=document.createElement("div"),n=(a.className="relative w-full max-w-5xl mx-auto px-8 pb-8 text-gray-800 dark:text-white",document.createElement("div")),o=(n.className="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-neutral-800 text-gray-700 dark:text-white p-4 rounded-xl shadow-md font-baloo text-sm flex justify-between items-center gap-4 flex-wrap md:flex-nowrap",document.createElement("p")),l=(o.textContent='This application uses cookies as they are required for its function. For more information, please contact the site owner for their cookie policy. By clicking "Accept", you agree to the use of cookies for 365 days. By clicking "Decline", you will be redirected away from this site and a cookie will be stored for 30 days to remember your rejection.',document.createElement("div")),s=(l.className="flex gap-3",document.createElement("button")),r=(s.className="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-4 rounded-xl shadow-sm transition-all duration-100 cursor-pointer",s.innerHTML='<i class="fas fa-check"></i><span>Accept</span>',s.addEventListener("click",()=>{i("cookieConsent","accepted",365),document.body.removeChild(e),document.body.removeChild(t)}),document.createElement("button"));function i(e,t,a){var n=new Date,a=(n.setTime(n.getTime()+24*a*60*60*1e3),"expires="+n.toUTCString());document.cookie=e+"="+t+";"+a+";path=/"}r.className="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-4 rounded-xl shadow-sm transition-all duration-100 cursor-pointer",r.innerHTML='<i class="fas fa-xmark"></i><span>Decline</span>',r.addEventListener("click",()=>{i("cookieConsent","denied",30),window.location.href="https://www.google.com"}),l.appendChild(s),l.appendChild(r),n.appendChild(o),n.appendChild(l),a.appendChild(n),t.appendChild(a),document.body.appendChild(e),document.body.appendChild(t)}}),document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector('[data-action="toggleDarkMode"]'),t=(e&&(document.cookie.includes("darkmode=true")&&(e.innerHTML='<i class="fa-regular fa-moon align-top"></i>'),e.addEventListener("click",function(){e.innerHTML.includes("fa-sun")?(e.innerHTML='<i class="fa-regular fa-moon align-top"></i>',document.body.classList.add("dark"),document.cookie="darkmode=true;path=/"):(e.innerHTML='<i class="fa-regular fa-sun align-top"></i>',document.body.classList.remove("dark"),document.cookie="darkmode=false;path=/")})),document.querySelector('[data-action="wsql-darkmode-toggle"]'));function a(e){t.querySelector("i").innerHTML="",t.querySelector("i").classList.remove("fa-sun","fa-moon"),t.querySelector("i").classList.add("dark"===e?"fa-sun":"fa-moon"),t.querySelector("h1").textContent="dark"===e?"Light mode":"Dark mode"}t&&(document.cookie.includes("darkmode=true")?a("dark"):a("light"),t.addEventListener("click",function(){t.innerHTML.includes("fa-sun")?(a("light"),document.body.classList.remove("dark"),document.cookie="darkmode=false;path=/"):(a("dark"),document.body.classList.add("dark"),document.cookie="darkmode=true;path=/")}))}),document.addEventListener("DOMContentLoaded",function(){headerElements={},headerFunctions={open:function(){document.querySelector('[data-component="wsql-header"]').classList.remove("-left-full"),document.querySelector('[data-component="wsql-header"]').classList.add("left-0")},close:function(){document.querySelector('[data-component="wsql-header"]').classList.remove("left-0"),document.querySelector('[data-component="wsql-header"]').classList.add("-left-full")}},document.querySelector('[data-action="wsql-header-open"]')&&document.querySelector('[data-action="wsql-header-open"]').addEventListener("click",function(){headerFunctions.open()}),document.querySelector('[data-action="wsql-header-close"]')&&document.querySelector('[data-action="wsql-header-close"]').addEventListener("click",function(){headerFunctions.close()}),document.querySelector('[data-action="wsql-darkmode-toggle"]')&&document.querySelector('[data-action="wsql-darkmode-toggle"]').addEventListener("click",function(){headerFunctions.close()}),document.querySelector('[data-action="wsql-logout"]')&&document.querySelector('[data-action="wsql-logout"]').addEventListener("click",function(){headerFunctions.close()}),document.querySelectorAll('[data-component="wsql-header"] a').forEach(function(e){e.addEventListener("click",function(){headerFunctions.close()})})}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector('[data-action="wsql-logout"]');e&&e.addEventListener("click",function(){fetch(logout_endpoint,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{"success"===e.status?(WsqlToast.show("Logged out successfully, redirecting...","success"),window.location.href=public_url):WsqlToast.show("Failed to logout: "+e.message,"danger")})})}),document.addEventListener("DOMContentLoaded",function(e){let u={},p={};document.querySelector('[data-table="wsql-roles"]')&&(u.roleTable=new WsqlTable(document.querySelector('[data-table="wsql-roles"]')),u.roleTable.setColumns([{key:"name",label:"Name",callback:(e,t)=>{var a=document.createElement("span"),e=(a.className="block leading-5 mt-1",a.textContent=e,document.createElement("span")),t=(e.className="text-gray-400 font-light text-sm whitespace-break-spaces",e.textContent=t.description,document.createElement("div"));return t.appendChild(a),t.appendChild(e),t}},{key:"app_access",label:"App Access",callback:(e,t)=>{var a=document.createElement("span");return a.className="inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium "+(1===e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),a.textContent=1===e?"Yes":"No",a}},{key:"administrator",label:"Administrator",callback:(e,t)=>{var a=document.createElement("span");return a.className="inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium "+(1===e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),a.textContent=1===e?"Yes":"No",a}},{key:"public_access",label:"Public Access",callback:(e,t)=>{var a=document.createElement("span");return a.className="inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium "+(1===e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),a.textContent=1===e?"Yes":"No",a}}]),u.roleTable.setActions([{name:"Edit",icon:"fa-solid fa-edit",callback:e=>{window.location.href="/admin/access-control/"+e.uuid}},{name:"Delete",icon:"fa-solid fa-trash-can",callback:e=>p.deleteRoleOpenModel(e)}]),u.roleTable.setSource({apiEndpoint:roles_endpoint,dataSelector:"data"}),u.roleTable.setButtons([{name:"Create role",icon:"fa-solid fa-shield-halved",callback:()=>{p.createRoleOpenModel(function(){u.roleTable.render()})}}]),u.roleTable.setName("roles"),u.roleTable.render()),p.createRoleOpenModel=async function(e){var t=document.createElement("div"),a=document.createElement("div"),n=(a.className="mb-8",document.createElement("h1")),n=(n.className="text-xl text-gray-700 dark:text-white font-baloo font-semibold",n.textContent="Create role",a.appendChild(n),document.createElement("p")),n=(n.className="text-md text-gray-700 dark:text-white font-baloo font-normal",n.textContent="Enter a name and description for the new role.",a.appendChild(n),document.createElement("div"));n.className="grid grid-cols-1 gap-4";let o=WsqlElements.labelTextInput("wsql-role-name","Name","text"),l=(n.appendChild(o),WsqlElements.labelTextareaInput("wsql-role-description","Description",4)),s=(n.appendChild(l),WsqlElements.switchInput("App Access","This will allow the role to access the application")),r=(n.appendChild(s),WsqlElements.switchInput("Administrator","This will give the role full access to the application and API")),i=(n.appendChild(r),WsqlElements.switchInput("Public Access","Permissions assigned to the role will be available to the public"));n.appendChild(i);var d=document.createElement("div"),c=(d.className="flex gap-4 mt-8",WsqlElements.button("Create","fas fa-shield-halved",()=>{o.querySelector("input").value&&l.querySelector("textarea").value?p.createRole({name:o.querySelector("input").value,description:l.querySelector("textarea").value,app_access:"true"===s.querySelector("button").getAttribute("checked")?1:0,administrator:"true"===r.querySelector("button").getAttribute("checked")?1:0,public_access:"true"===i.querySelector("button").getAttribute("checked")?1:0},(e,t)=>{e?(p.closeModel(m),WsqlToast.show("Role created successfully","success"),u.roleTable.reload()):WsqlToast.show(t,"danger")}):WsqlToast.show("Please fill in all required fields","danger")})),c=(d.appendChild(c),WsqlElements.button("Cancel","fas fa-times",()=>{p.closeModel(m)}));d.appendChild(c),t.appendChild(a),t.appendChild(n),t.appendChild(d);let m=p.createModel(t)},p.deleteRoleOpenModel=function(e){var t=document.createElement("div"),a=document.createElement("p"),n=(a.className="text-md text-gray-700 dark:text-white font-baloo font-normal",a.textContent="Are you sure you want to delete the following role?",document.createElement("h1")),o=(n.className="font-semibold text-lg py-4",n.textContent=e.name,document.createElement("div")),l=(o.className="flex gap-4",WsqlElements.button("Delete","fas fa-trash-can",()=>{p.deleteRole(e.uuid,(e,t)=>{e?(p.closeModel(r),WsqlToast.show("Role deleted successfully","success"),u.roleTable.reload()):WsqlToast.show(t,"danger")})})),s=WsqlElements.button("Cancel","fas fa-times",()=>{p.closeModel(r)});o.appendChild(l),o.appendChild(s),t.appendChild(a),t.appendChild(n),t.appendChild(o);let r=p.createModel(t)},p.getRoleId=function(){return new URL(window.location.href).pathname.split("/").pop()},document.querySelector('[data-form="wsql-role-details"]')&&fetch(roles_single_endpoint.replace("{id}",p.getRoleId()),{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{p.wsqlRoleDetailsForm(e)}),p.wsqlRoleDetailsForm=function(e){var t=document.querySelector('[data-form="wsql-role-details"]'),a=document.createElement("div"),n=(a.className="grid grid-cols-2 gap-8",document.createElement("div"));n.className="col-span-1 grid grid-cols-1 gap-4";let o=WsqlElements.labelTextInput("wsql-role-name","Name","text"),l=(o.querySelector("input").value=e.name,WsqlElements.labelTextareaInput("wsql-role-description","Description",4));l.querySelector("textarea").value=e.description,n.appendChild(o),n.appendChild(l);var s=document.createElement("div");s.className="col-span-1 grid grid-cols-1 gap-4";let r=WsqlElements.switchInput("App Access","This will allow the role to access the application"),i=(e.app_access&&r.querySelector("button").click(),WsqlElements.switchInput("Administrator","This will give the role full access to the application and API")),d=(e.administrator&&i.querySelector("button").click(),WsqlElements.switchInput("Public Access","Permissions assigned to the role will be available to the public"));e.public_access&&d.querySelector("button").click(),s.appendChild(r),s.appendChild(i),s.appendChild(d);var c=document.createElement("div"),m=(c.className="col-span-2 flex gap-4",WsqlElements.button("Update","fas fa-save",()=>{p.updateRole(e.uuid,{name:o.querySelector("input").value,description:l.querySelector("textarea").value,app_access:"true"===r.querySelector("button").getAttribute("checked")?1:0,administrator:"true"===i.querySelector("button").getAttribute("checked")?1:0,public_access:"true"===d.querySelector("button").getAttribute("checked")?1:0},(e,t)=>{e?WsqlToast.show("Role updated successfully","success"):WsqlToast.show(t,"error")})}));c.appendChild(m),a.appendChild(n),a.appendChild(s),a.appendChild(c),t.innerHTML="",t.appendChild(a)},document.querySelector('[data-table="wsql-role-permissions"]')&&(u.permissionsTable=new WsqlTable(document.querySelector('[data-table="wsql-role-permissions"]')),u.permissionsTable.setColumns([{key:"name",label:"Name"},{key:"enabled",label:"Enabled",callback:(e,t)=>{var a=document.createElement("span");return a.className="inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium "+(1===e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),a.textContent=1===e?"Yes":"No",a}},{key:"filter",label:"Filter",callback:(e,t)=>{var a=document.createElement("span");return a.className="inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium "+(e?"whitespace-pre truncate":"bg-gray-100 text-gray-800"),a.textContent=e||"None",a}}]),u.permissionsTable.setActions([{name:"Edit",icon:"fas fa-edit",callback:e=>console.log("Edit clicked for:",e)},{name:"Delete",icon:"fas fa-trash",callback:e=>{p.deletePermissionOpenModel(e)}}]),u.permissionsTable.setSource({apiEndpoint:roles_single_permissions_endpoint.replace("{id}",p.getRoleId()),dataSelector:"data"}),u.permissionsTable.setButtons([{name:"Add permission",icon:"fas fa-edit",callback:()=>{p.createPermissionOpenModel()}}]),u.permissionsTable.setName("permissions"),u.permissionsTable.render()),p.createPermissionOpenModel=async function(){let o=[];var e=document.createElement("div"),t=document.createElement("div"),a=(t.className="mb-8",document.createElement("h1")),a=(a.className="text-xl text-gray-700 dark:text-white font-baloo font-semibold",a.textContent="Add permission",t.appendChild(a),document.createElement("p")),a=(a.className="text-md text-gray-700 dark:text-white font-baloo font-normal",a.textContent="Select a permission from the dropdown to add a new permission.",t.appendChild(a),document.createElement("div"));a.className="grid grid-cols-1 gap-4";let l=await(await fetch(permissions_endpoint)).json(),n=[];l.forEach(e=>{n.push({id:e.name,title:e.name,description:e.description||"No description available",tag:e.type||null})});var s=document.createElement("div"),r=WsqlElements.labelCustomDropdown("wsql-permissions-permission","Permission",n,{onSelect:t=>{(o=[]).push(t.id);var e=l.find(e=>e.name===t.id);if(e.dependents){i.innerHTML="";var n=document.createElement("div");n.className="mt-4 bg-blue-100 text-blue-800 border border-blue-600 p-4 rounded-lg font-baloo font-normal text-sm",n.textContent="This permission requires the following dependent permissions, these will be added automatically if not already:";let a=document.createElement("ul");a.className="list-disc ml-4 font-baloo font-normal text-sm",e.dependents.forEach(e=>{o.push(e);var t=document.createElement("li");t.textContent=e,a.appendChild(t)}),n.appendChild(a),i.appendChild(n)}else i.innerHTML=""}});s.appendChild(r);let i=document.createElement("span"),d=(s.appendChild(i),a.appendChild(s),WsqlElements.labelTextareaInput("wsql-permissions-filter","Filter",4)),c=(a.appendChild(d),WsqlElements.switchInput("Enabled","This will enable the permission for the role"));a.appendChild(c);r=document.createElement("div"),r.className="flex gap-4 mt-8",s=WsqlElements.button("Add","fas fa-shield-halved",()=>{try{o.forEach(e=>{p.createPermission({name:e,filter:d.querySelector("textarea").value,enabled:"true"===c.querySelector("button").getAttribute("checked")?1:0},(e,t)=>{if(!e&&"A permission with the same name already exists"!=t)throw new Error(t)})}),p.closeModel(m),WsqlToast.show("Permission added successfully","success"),u.permissionsTable.reload()}catch(e){p.closeModel(m),WsqlToast.show(e.message,"danger")}}),r.appendChild(s),s=WsqlElements.button("Cancel","fas fa-times",()=>{p.closeModel(m)});r.appendChild(s),e.appendChild(t),e.appendChild(a),e.appendChild(r);let m=p.createModel(e)},p.editPermissionOpenModel=function(e){},p.deletePermissionOpenModel=function(e){var t=document.createElement("div"),a=document.createElement("p"),n=(a.className="text-md text-gray-700 dark:text-white font-baloo font-normal",a.textContent="Are you sure you want to delete the following permission?",document.createElement("h1")),o=(n.className="font-semibold text-lg py-4",n.textContent=e.name,document.createElement("div")),l=(o.className="flex gap-4",WsqlElements.button("Delete","fas fa-trash-can",()=>{p.deletePermission(e.id,(e,t)=>{e?(p.closeModel(r),WsqlToast.show("Permission deleted successfully","success"),u.permissionsTable.reload()):WsqlToast.show(t,"danger")})})),s=WsqlElements.button("Cancel","fas fa-times",()=>{p.closeModel(r)});o.appendChild(l),o.appendChild(s),t.appendChild(a),t.appendChild(n),t.appendChild(o);let r=p.createModel(t)},p.createModel=function(e,t="max-w-xl"){let a=document.createElement("div");a.className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 invisible opacity-0 transition-all duration-100";var n=document.createElement("div");return n.className="bg-white dark:bg-zinc-900 rounded-lg shadow-lg p-8 w-full "+t,n.appendChild(e),a.appendChild(n),document.body.appendChild(a),setTimeout(()=>{a.classList.remove("invisible","opacity-0"),a.classList.add("visible","opacity-100")},1),a},p.closeModel=function(e){e.classList.remove("visible","opacity-100"),e.classList.add("invisible","opacity-0"),setTimeout(()=>{e.remove()},100)},p.createRole=async function(e,t){try{var a,n=await fetch(roles_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw a=await n.json(),new Error(a.message);t&&"function"==typeof t&&t(!0)}catch(e){t&&"function"==typeof t&&t(!1,e.message)}},p.createPermission=async function(e,t){try{var a,n=await fetch(roles_single_permissions_endpoint.replace("{id}",p.getRoleId()),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw a=await n.json(),new Error(a.message);t&&"function"==typeof t&&t(!0)}catch(e){t&&"function"==typeof t&&t(!1,e.message)}},p.updateRole=async function(e,t,a){try{var{name:n,description:o,app_access:l,administrator:s,public_access:r}=t;if(!n||!o)throw new Error("Please fill in all required fields");var i,d=await fetch(roles_single_endpoint.replace("{id}",e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,description:o,app_access:l,administrator:s,public_access:r})});if(!d.ok)throw i=await d.json(),new Error(i.message);a&&"function"==typeof a&&a(!0)}catch(e){a&&"function"==typeof a&&a(!1,e.message)}},p.deleteRole=async function(e,t){try{var a,n=await fetch(roles_single_endpoint.replace("{id}",e),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!n.ok)throw a=await n.json(),new Error(a.message);t&&"function"==typeof t&&t(!0)}catch(e){t&&"function"==typeof t&&t(!1,e.message)}},p.deletePermission=async function(e,t){try{var a,n=await fetch(roles_single_permissions_single_endpoint.replace("{role_id}",p.getRoleId()).replace("{permission_id}",e),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!n.ok)throw a=await n.json(),new Error(a.message);t&&"function"==typeof t&&t(!0)}catch(e){t&&"function"==typeof t&&t(!1,e.message)}}}),document.addEventListener("DOMContentLoaded",function(e){let l=document.getElementById("wsql-branding-name"),t=document.getElementById("wsql-branding-logo-light"),s=document.getElementById("wsql-branding-logo-dark");function d(){fetch("/api/settings/branding").then(e=>e.json()).then(a=>{if(console.log("Fetched branding data:",a),t&&(t.innerHTML="",a.data.logo.light?r(a.data.logo.light,t,"light"):i(t,"light")),l){var n=l;var o=a.data.application_name;n.innerHTML="";let e=document.createElement("input");e.type="text",e.name="branding_application_name",e.className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-transparent",o&&(e.value=o),n.appendChild(e);let t;e.addEventListener("input",function(){clearTimeout(t),t=setTimeout(()=>{(async e=>{try{var t,a=await fetch("/api/settings/branding",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update_name",data:{application_name:e}})});if(!a.ok)throw t=await a.json(),new Error("Error updating application name: "+t.message);WsqlToast.show("Application name updated successfully","success")}catch(e){WsqlToast.show(e.message,"danger")}})(e.value)},500)})}s&&(s.innerHTML="",a.data.logo.dark?r(a.data.logo.dark,s,"dark"):i(s,"dark"))}).catch(e=>{console.error("Error fetching branding data:",e)})}function r(e,t,a){var n=document.createElement("div"),o=(n.className="flex rounded-lg shadow border justify-center p-4 mt-3 "+("dark"===a?"bg-gray-700 border-gray-900":"bg-white border-gray-300"),document.createElement("img"));switch(o.alt=`Application Logo (${a}-mode)`,o.className="h-14",e.type){case"image":o.src=e.data.url;break;case"media":o.src=public_url+e.data.url}n.appendChild(o);var l=document.createElement("div"),s=(l.id="wsql-branding-logo-dark-remove",l.className="pt-3",document.createElement("button"));s.className="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-4 rounded-xl shadow-sm transition-all duration-100 cursor-pointer",s.id=`wsql-branding-logo-${a}-remove`,s.textContent="Remove logo",s.addEventListener("click",()=>(async e=>{e="light"===e?"remove_lm_logo":"remove_dm_logo";try{var t,a=await fetch("/api/settings/branding",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})});if(!a.ok)throw t=await a.json(),new Error("Error removing logo: "+t.message);WsqlToast.show("Logo removed successfully","success"),d()}catch(e){WsqlToast.show(e.message,"danger")}})(a)),l.appendChild(s),t.appendChild(n),t.appendChild(l)}function i(e,t){var a=document.createElement("form"),n=(a.id="wsql-branding-logo-"+t,document.createElement("div"));n.className="flex gap-3 pt-3";let o=document.createElement("input");o.type="file",o.id=`wsql-branding-logo-${t}-file`,o.className="hidden",o.accept="image/*";var l=document.createElement("label"),s=(l.htmlFor=`wsql-branding-logo-${t}-file`,l.className="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-4 rounded-xl shadow-sm transition-all duration-100 cursor-pointer",document.createElement("i")),r=(s.className="fas fa-image",document.createElement("span")),s=(r.textContent="Select image",l.appendChild(s),l.appendChild(r),document.createElement("button")),r=(s.type="submit",s.className="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-4 rounded-xl shadow-sm transition-all duration-100 cursor-pointer",document.createElement("i")),i=(r.className="fas fa-upload",document.createElement("span")),r=(i.textContent="Upload",s.appendChild(r),s.appendChild(i),n.appendChild(o),n.appendChild(l),n.appendChild(s),document.createElement("div"));r.id=`wsql-branding-logo-${t}-response`,r.className="mt-3",a.appendChild(n),a.appendChild(r),e.appendChild(a),a.addEventListener("submit",function(e){e.preventDefault(),(async(e,t)=>{if(e.files.length){var a=new FormData;a.append("file",e.files[0]);try{var n=await fetch("/api/media/upload",{method:"POST",body:a}),o=await n.json();if(!n.ok)throw new Error("Error uploading image: "+o.message);var l,s="light"===t?"add_lm_logo":"add_dm_logo",r=await fetch("/api/settings/branding",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s,data:{type:"media",id:o.file.id}})});if(!r.ok)throw l=await r.json(),new Error("Error updating branding: "+l.message);WsqlToast.show("Logo uploaded successfully","success"),d()}catch(e){WsqlToast.show(e.message,"danger")}}else WsqlToast.show("Please select an image to upload","warning")})(o,t)})}l&&t&&s&&d()}),document.addEventListener("DOMContentLoaded",function(e){let h={},f={};document.querySelector('[data-table="wsql-users"]')&&(h.usersTable=new WsqlTable(document.querySelector('[data-table="wsql-users"]')),h.usersTable.setColumns([{key:null,label:"Status",callback:(e,t)=>{var a=document.createElement("span");return a.className="inline-flex items-center px-3.5 py-1 rounded-full text-sm font-medium "+(0===t.approved?"bg-yellow-100 text-yellow-800":1===t.locked?"bg-red-100 text-red-800":0===t.email_verified?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"),a.textContent=0===t.approved?"Unapproved":1===t.locked?"Locked":0===t.email_verified?"Email unverified":"Active",a}},{key:null,label:"User",callback:(e,t)=>{var a=document.createElement("span"),n=(a.className="block leading-5 mt-1",a.textContent=t.firstname+" "+t.lastname,document.createElement("span")),t=(n.className="text-gray-400 font-light text-sm whitespace-break-spaces",n.textContent=t.email,document.createElement("div"));return t.appendChild(a),t.appendChild(n),t}},{key:null,label:"Role",callback:(e,t)=>{console.log(e);e=document.createElement("span");return e.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium "+(t.role?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),e.textContent=t.role?""+t.role.name:"No Role",e}},{key:"created_at",label:"Created at"}]),h.usersTable.setActions([{name:"Edit",icon:"fa-solid fa-edit",callback:e=>{window.location.href="/admin/users/"+e.uuid}},{name:"Delete",icon:"fa-solid fa-trash-can",callback:e=>{f.deleteUserOpenModel(e)}}]),h.usersTable.setSource({apiEndpoint:users_endpoint,dataSelector:"data"}),h.usersTable.setButtons([{name:"Create user",icon:"fa-solid fa-user-plus",callback:()=>{f.createUserOpenModel()}}]),h.usersTable.setName("users"),h.usersTable.render()),f.createUserOpenModel=async function(){var e=document.createElement("div"),t=document.createElement("div"),a=(t.className="mb-8",document.createElement("h1")),a=(a.className="text-xl text-gray-700 dark:text-white font-baloo font-semibold",a.textContent="Create User",t.appendChild(a),document.createElement("p")),a=(a.className="text-md text-gray-700 dark:text-white font-baloo font-normal",a.textContent="Enter the user details below to create a new user.",t.appendChild(a),document.createElement("div"));a.className="grid grid-cols-1 sm:grid-cols-2 gap-4";let n=WsqlElements.labelTextInput("wsql-user-firstname","Firstname","text"),o=(a.appendChild(n),WsqlElements.labelTextInput("wsql-user-lastname","Lastname","text")),l=(a.appendChild(o),WsqlElements.labelTextInput("wsql-user-email","Email","email","col-span-2")),s=(a.appendChild(l),WsqlElements.labelTextInput("wsql-user-password","Password","password","col-span-2"));a.appendChild(s);var r=document.createElement("div"),i=(r.className="col-span-2",document.createElement("p"));i.className="block text-base font-medium text-gray-700 dark:text-white transition-all duration-300",i.textContent="Role";let d=document.createElement("select");d.className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-transparent";var c=document.createElement("option");c.value="",c.textContent="Select a role",c.disabled=!0,c.selected=!0,d.appendChild(c);c=await(await fetch(roles_endpoint)).json();console.log(c),c.data.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=e.name,d.appendChild(t)}),r.appendChild(i),r.appendChild(d),a.appendChild(r);let m=WsqlElements.switchInput("Approved","Toggle the switch to approve the user.","col-span-2"),u=(a.appendChild(m),WsqlElements.switchInput("Email verified","Toggle the switch to verify the user's email address.","col-span-2"));a.appendChild(u);c=document.createElement("div"),c.className="flex gap-4 mt-8",i=WsqlElements.button("Create","fas fa-user-plus",()=>{f.createUser({firstname:n.querySelector("input").value,lastname:o.querySelector("input").value,email:l.querySelector("input").value,password:s.querySelector("input").value,role:d.value,approved:"true"===m.querySelector("button").getAttribute("checked")?1:0,email_verified:"true"===u.querySelector("button").getAttribute("checked")?1:0},(e,t)=>{e?(f.closeModel(p),WsqlToast.show("User created successfully","success"),h.usersTable.reload()):WsqlToast.show(t,"danger")})}),c.appendChild(i),r=WsqlElements.button("Cancel","fas fa-times",()=>{f.closeModel(p)});c.appendChild(r),e.appendChild(t),e.appendChild(a),e.appendChild(c);let p=f.createModel(e)},f.deleteUserOpenModel=async function(e){var t=document.createElement("div"),a=document.createElement("p"),n=(a.className="text-md text-gray-700 dark:text-white font-baloo font-normal",a.textContent="Are you sure you want to delete the following user?",e.email.trim().toLowerCase()),n=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(n)),n=Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join(""),o=document.createElement("div"),l=(o.className="my-6 cursor-pointer w-full flex items-center gap-3 py-3 px-4 border border-zinc-100 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700 text-zinc-700 dark:text-white text-sm font-baloo font-normal leading-3 rounded-xl transition-all duration-100",document.createElement("div")),s=(l.className="w-10 h-10 bg-zinc-200 dark:bg-neutral-700 rounded-full",document.createElement("img")),n=(s.src=`https://gravatar.com/avatar/${n}?size=40&d=mp`,s.alt="Avatar",s.className="w-full h-full object-cover rounded-full shadow",l.appendChild(s),o.appendChild(l),document.createElement("div")),s=(n.className="flex flex-col",document.createElement("h1")),l=(s.className="font-baloo font-semibold m-0 text-lg leading-5 text-zinc-800 dark:text-white",s.textContent=e.firstname+" "+e.lastname,document.createElement("p")),l=(l.className="flex gap-2 font-baloo font-normal m-0 text-sm leading-3 text-zinc-600 dark:text-zinc-300",l.textContent=e.email,s.appendChild(l),n.appendChild(s),o.appendChild(n),document.createElement("div")),s=(l.className="flex gap-4",WsqlElements.button("Delete","fas fa-trash-can",()=>{f.deleteUser(e.uuid,(e,t)=>{e?(f.closeModel(r),WsqlToast.show("User deleted successfully","success"),h.usersTable.reload()):WsqlToast.show(t,"danger")})})),n=(l.appendChild(s),WsqlElements.button("Cancel","fas fa-times",()=>{f.closeModel(r)}));l.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(l);let r=f.createModel(t)},f.createModel=function(e,t="max-w-xl"){let a=document.createElement("div");a.className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 invisible opacity-0 transition-all duration-100";var n=document.createElement("div");return n.className="bg-white dark:bg-zinc-900 rounded-lg shadow-lg p-8 w-full "+t,n.appendChild(e),a.appendChild(n),document.body.appendChild(a),setTimeout(()=>{a.classList.remove("invisible","opacity-0"),a.classList.add("visible","opacity-100")},1),a},f.closeModel=function(e){e.classList.remove("visible","opacity-100"),e.classList.add("invisible","opacity-0"),setTimeout(()=>{e.remove()},100)},f.createUser=async function(e,t){try{var{firstname:a,lastname:n,email:o,password:l,role:s,approved:r,email_verified:i}=e;if(a&&n&&o&&l){var d,c=await fetch(users_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:a,lastname:n,email:o,password:l,role:s,approved:r,email_verified:i})});if(!c.ok)throw d=await c.json(),new Error(d.message);t&&"function"==typeof t&&t(!0)}else WsqlToast.show("Please fill in all required fields","warning")}catch(e){t&&"function"==typeof t&&t(!1,e.message)}},f.deleteUser=async function(e,t){try{var a,n=await fetch(users_single_endpoint.replace("{id}",e),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!n.ok)throw a=await n.json(),new Error(a.message);t&&"function"==typeof t&&t(!0)}catch(e){t&&"function"==typeof t&&t(!1,e.message)}}});var public_url=window.location.origin;let logout_endpoint=public_url+"/api/auth/logout",users_me_endpoint=public_url+"/api/users/me",users_me_password_reset_endpoint=public_url+"/api/users/me/reset-password",users_endpoint=public_url+"/api/users",users_single_endpoint=public_url+"/api/users/{id}",roles_endpoint=public_url+"/api/roles",roles_single_endpoint=public_url+"/api/roles/{id}",roles_single_permissions_endpoint=public_url+"/api/roles/{id}/permissions",roles_single_permissions_single_endpoint=public_url+"/api/roles/{role_id}/permissions/{permission_id}",permissions_endpoint=public_url+"/api/permissions",wsql_standard_button="flex items-center gap-2 h-10 py-2 px-5 bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-gray-700 dark:text-white border border-gray-300 dark:border-white text-base font-baloo font-medium leading-3 rounded-xl shadow-sm transition-all duration-100 cursor-pointer disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50";class WsqlDateTimePicker{constructor(e){if(!e)throw new Error("A valid DOM element must be provided.");this.targetElement=e,this.pickerElement=null,this.initPicker()}initPicker(){this.pickerElement=document.createElement("div"),this.pickerElement.className="fixed z-50 bg-white border border-gray-300 shadow-lg rounded-lg p-4 w-80 space-y-4";var e=document.createElement("div"),t=document.createElement("label"),t=(t.className="block text-sm font-medium text-gray-700",t.textContent="Select Date",e.appendChild(t),document.createElement("input")),t=(t.type="date",t.id="date-input",t.className="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",e.appendChild(t),document.createElement("div")),a=document.createElement("label"),a=(a.className="block text-sm font-medium text-gray-700",a.textContent="Select Time",t.appendChild(a),document.createElement("div")),n=(a.className="flex space-x-2 mt-1",document.createElement("input")),n=(n.type="number",n.id="hour-input",n.min=0,n.max=23,n.placeholder="HH",n.className="w-16 px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",a.appendChild(n),document.createElement("input")),n=(n.type="number",n.id="minute-input",n.min=0,n.max=59,n.placeholder="MM",n.className="w-16 px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",a.appendChild(n),document.createElement("input")),n=(n.type="number",n.id="second-input",n.min=0,n.max=59,n.placeholder="SS",n.className="w-16 px-2 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",a.appendChild(n),t.appendChild(a),document.createElement("div")),a=(n.className="flex justify-end space-x-2",document.createElement("button")),a=(a.id="cancel-btn",a.className="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",a.textContent="Cancel",n.appendChild(a),document.createElement("button"));a.id="apply-btn",a.className="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",a.textContent="Apply",n.appendChild(a),this.pickerElement.appendChild(e),this.pickerElement.appendChild(t),this.pickerElement.appendChild(n),document.body.appendChild(this.pickerElement),this.positionPicker(),this.addEventListeners()}positionPicker(){var e=this.targetElement.getBoundingClientRect();this.pickerElement.style.top=e.bottom+window.scrollY+8+"px",this.pickerElement.style.left=e.left+window.scrollX+"px"}addEventListeners(){var e=this.pickerElement.querySelector("#cancel-btn"),t=this.pickerElement.querySelector("#apply-btn");e.addEventListener("click",()=>this.closePicker()),t.addEventListener("click",()=>{var e=this.pickerElement.querySelector("#date-input").value,t=this.pickerElement.querySelector("#hour-input").value,a=this.pickerElement.querySelector("#minute-input").value,n=this.pickerElement.querySelector("#second-input").value;e&&""!==t&&""!==a&&""!==n?(e=`${e} ${t.padStart(2,"0")}:${a.padStart(2,"0")}:`+n.padStart(2,"0"),this.targetElement.value=e,this.closePicker()):alert("Please select date, hour, minute, and second.")})}closePicker(){this.pickerElement&&(this.pickerElement.remove(),this.pickerElement=null)}}class WsqlElements{static button(e,t,a,n={}){var n=n.divClass||"",o=document.createElement("button"),n=(o.className="flex items-center justify-center gap-2 h-10 py-1 px-5 border border-transparent rounded-md shadow-sm text-base font-baloo font-medium text-white leading-4 bg-neutral-700 hover:bg-neutral-700/90 dark:hover:bg-neutral-700/80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-600 cursor-pointer transition-all duration-300 "+n,document.createElement("i")),t=(n.className=t,document.createElement("span"));return t.textContent=e,o.appendChild(n),o.appendChild(t),a&&o.addEventListener("click",a),o}static switchInput(e,t,a=""){var n=document.createElement("div"),a=(n.className="flex items-center justify-between "+a,document.createElement("span")),o=(a.className="flex flex-grow flex-col",document.createElement("span")),e=(o.className="text-base font-baloo font-medium text-gray-900 dark:text-white",o.id="availability-label",o.textContent=e,document.createElement("span"));e.className="text-sm font-baloo text-gray-500 dark:text-gray-400",e.id="availability-description",e.textContent=t,a.appendChild(o),a.appendChild(e);let l=document.createElement("button"),s=(l.type="button",l.className="bg-gray-200 relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-neutral-600 focus:ring-offset-2",l.setAttribute("role","switch"),l.setAttribute("checked","false"),document.createElement("span"));return s.className="translate-x-0 pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",l.appendChild(s),l.addEventListener("click",()=>{var e="true"===l.getAttribute("checked");l.setAttribute("checked",e?"false":"true"),l.classList.toggle("bg-gray-200"),l.classList.toggle("bg-neutral-600"),s.classList.toggle("translate-x-5"),s.classList.toggle("translate-x-0")}),n.appendChild(a),n.appendChild(l),n}static textInput(e,t,a={}){var n=a.class||"",o=a.required||!1,l=a.placeholder||"",s=a.disabled||!1,r=a.id||e,a=a.style||"",i=document.createElement("input");return i.className="block w-full font-baloo h-10 py-1 px-5 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-neutral-600 focus:border-neutral-600 text-sm sm:text-base bg-transparent "+n,i.name=e,i.id=r,i.type=t,i.placeholder=l,i.disabled=s,i.required=o,i.style=a,i}static labelTextInput(e,t,a,n=""){var o=document.createElement("div"),n=(o.className=n,document.createElement("label")),t=(n.htmlFor=e,n.className="block mb-1 text-base font-medium font-baloo text-gray-700 dark:text-white transition-all duration-300",n.textContent=t,this.textInput(e,a,!0));return o.appendChild(n),o.appendChild(t),o}static textareaInput(e,t=4,a={}){var n=a.class||"",o=a.required||!1,l=a.placeholder||"",s=a.disabled||!1,r=a.id||e,a=a.style||"",i=document.createElement("textarea");return i.className="block w-full font-baloo px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm sm:text-base bg-transparent "+n,i.name=e,i.rows=t,i.id=r,i.style=a,i.required=o,i.disabled=s,i.placeholder=l,i}static labelTextareaInput(e,t,a=4,n=""){var o=document.createElement("div"),n=(o.className=n,document.createElement("label")),t=(n.htmlFor=e,n.className="block mb-1 text-base font-baloo font-medium text-gray-700 dark:text-white transition-all duration-300",n.textContent=t,o.appendChild(n),this.textareaInput(e,a));return o.appendChild(t),o}static selectInput(e,t=[],a={}){var n=a.class||"",o=a.title||"",l=a.required||!1,a=a.id||e;let s=document.createElement("select");return s.className="block w-full font-baloo leading-3 h-10 py-1 px-5 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-neutral-600 focus:border-neutral-600 text-sm sm:text-base bg-transparent "+n,s.name=e,s.id=a,s.required=l,s.title=o,t.forEach(e=>{var t=document.createElement("option");t.value=e.value,t.textContent=e.label,t.selected=e.selected||!1,t.disabled=e.disabled||!1,s.appendChild(t)}),s}static dateTimeInput(e,t={}){var a=t.class||"",n=t.required||!1,o=t.placeholder||"",l=t.disabled||!1,s=t.id||e,r=t.style||"",t=t.value||"",i=document.createElement("input");return i.className="block font-baloo w-full h-10 py-1 px-5 border border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-neutral-600 focus:border-neutral-600 text-sm sm:text-base bg-transparent "+a,i.name=e,i.id=s,i.type="datetime-local",i.placeholder=o,i.disabled=l,i.required=n,i.style=r,i.value=t,i}static labelDateTimeInput(e,t,a={},n=""){var o=document.createElement("div"),n=(o.className=n,document.createElement("label")),t=(n.htmlFor=e,n.className="block mb-1 text-base font-baloo font-medium text-gray-700 dark:text-white transition-all duration-300",n.textContent=t,o.appendChild(n),this.dateTimeInput(e,a));return o.appendChild(t),o}static customDropdown(e,t=[],o={}){let a=document.createElement("div"),l=(a.className="relative",document.createElement("input")),s=(l.type="hidden",l.name=e,l.value="",document.createElement("button")),r=(s.type="button",s.className="block w-full font-baloo h-10 py-1 px-5 border text-neutral-800 dark:text-white text-left border-neutral-300 rounded-md shadow-sm focus:outline-none focus:ring-neutral-600 focus:border-neutral-600 text-sm sm:text-base bg-transparent "+(o.class||""),s.textContent=o.placeholder||"Select an option",document.createElement("div"));r.className="absolute z-10 mt-1 p-3 w-full bg-white dark:bg-neutral-800 shadow-lg rounded-md overflow-hidden border border-neutral-300 hidden";e=document.createElement("input");e.type="text",e.className="block w-full font-baloo h-10 py-1 px-5 border border-neutral-300 text-neutral-800 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-neutral-600 focus:border-neutral-600 text-sm sm:text-base bg-transparent",e.placeholder="Search...";let i=document.createElement("div");return i.className="max-h-60 overflow-y-auto mt-2 flex flex-col gap-2",t.forEach(e=>{var t=document.createElement("div");t.className="p-2 hover:bg-neutral-200 dark:hover:bg-neutral-700 cursor-pointer rounded-md",t.dataset.value=e.id;let a=document.createElement("div");a.className="font-baloo font-medium text-gray-900 dark:text-white mb-1 flex gap-2 items-center",a.textContent=e.title,e.tag&&e.tag.split(";").forEach(e=>{var t=document.createElement("span");t.className="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800",t.textContent=e,a.appendChild(t)});var n=document.createElement("div");n.className="text-sm font-baloo text-gray-600 dark:text-gray-400",n.textContent=e.description,t.appendChild(a),t.appendChild(n),t.addEventListener("click",()=>{s.textContent=e.title,r.classList.add("hidden"),l.value=e.id,o.onSelect&&o.onSelect(e)}),i.appendChild(t)}),e.addEventListener("input",e=>{let n=e.target.value.toLowerCase();Array.from(i.children).forEach(e=>{var t=e.querySelector(".font-medium").textContent.toLowerCase(),a=e.querySelector(".text-sm").textContent.toLowerCase(),t=t.includes(n)||a.includes(n);e.style.display=t?"":"none"})}),s.addEventListener("click",()=>{r.classList.toggle("hidden")}),r.appendChild(e),r.appendChild(i),a.appendChild(l),a.appendChild(s),a.appendChild(r),document.addEventListener("click",e=>{a.contains(e.target)||r.classList.add("hidden")}),a}static labelCustomDropdown(e,t,a=[],n={},o=""){var l=document.createElement("div"),o=(l.className=o,document.createElement("label")),t=(o.htmlFor=e,o.className="block mb-1 text-base font-baloo font-medium text-gray-700 dark:text-white transition-all duration-300",o.textContent=t,l.appendChild(o),this.customDropdown(e,a,n));return l.appendChild(t),l}}class WsqlTable{constructor(e){this.container=e,this.columnsConfig=[],this.actionsConfig=[],this.buttonsConfig=[],this.limitConfig=[{value:5,label:"5",selected:!0},{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"}],this.apiEndpoint=null,this.dataSelector=null,this.data=[],this.totalRecords=0,this.currentPage=1,this.currentLimit=this.limitConfig[0].value,this.searchQuery="",this.tableName="table",this.elements={}}setLimits(e){return this.limitConfig=e,this.currentLimit=e[0],this}setColumns(e){return this.columnsConfig=e,this}setActions(e){return this.actionsConfig=e,this}setButtons(e){return this.buttonsConfig=e,this}setName(e){return this.tableName=e,this}setSource({apiEndpoint:e,dataSelector:t}){return this.apiEndpoint=e,this.dataSelector=t,this}async loadData(){if(this.apiEndpoint&&this.dataSelector)try{var e=new URL(this.apiEndpoint),t=(this.currentPage-1)*this.currentLimit;e.searchParams.append("offset",t),e.searchParams.append("limit",this.currentLimit),this.searchQuery&&e.searchParams.append("search",this.searchQuery);var a=await(await fetch(e.toString())).json();this.data=this.dataSelector.split(".").reduce((e,t)=>e[t],a),this.totalRecords=a.total||this.data.length}catch(e){console.error("Error loading data from API:",e),this.data=[],this.totalRecords=0}else console.error("API endpoint or dataSelector is not configured.")}async render(){this.apiEndpoint&&this.dataSelector?(await this.loadData(),this.createTableStructure(),this.renderTable(),this.renderPagination(),this.updateRecordInfo(),this.attachEventListeners()):console.error("API endpoint or dataSelector is not set. Call `.data()` before `.render()`.")}async reload(){console.log(this),await this.loadData(),this.renderTable(),this.renderPagination(),this.updateRecordInfo()}createTableStructure(){var e=document.createElement("div");e.className="flex justify-between items-center mb-6";let a=document.createElement("div");a.className="flex items-center gap-3",this.buttonsConfig.forEach(e=>{var t=WsqlElements.button(e.name,e.icon,()=>e.callback());a.appendChild(t)});var t=document.createElement("div"),n=(t.className="flex items-center",WsqlElements.textInput("wsql-table-search","text",{placeholder:`Search ${this.tableName}...`})),t=(t.appendChild(n),a.appendChild(t),document.createElement("div")),o=(t.className="flex items-center gap-3",document.createElement("div")),l=(o.className="flex items-center gap-3",document.createElement("label")),s=(l.textContent="Show",l.className="text-base",WsqlElements.selectInput("wsql-roles-limit",this.limitConfig)),l=(o.appendChild(l),o.appendChild(s),t.appendChild(o),e.appendChild(a),e.appendChild(t),document.createElement("div")),o=(l.className="overflow-x-auto overflow-y-hidden shadow ring-1 ring-gray-600 dark:ring-zinc-600 ring-opacity-5 md:rounded-md",document.createElement("table")),t=(o.className="min-w-full divide-y divide-gray-300 dark:divide-zinc-700",document.createElement("thead"));t.className="bg-gray-50 dark:bg-zinc-800";let r=document.createElement("tr");this.columnsConfig.forEach((e,t)=>{var a=document.createElement("th");a.textContent=e.label,a.className=`${0===t?"py-3.5 pl-4 pr-3":"py-3.5 px-3"}  text-left text-base font-semibold text-gray-900 dark:text-white font-baloo font-regular text-nowrap`,r.appendChild(a)}),0<this.actionsConfig.length&&((d=document.createElement("th")).className="py-3.5 pl-3 pr-4 text-left text-base font-semibold text-gray-900 dark:text-white font-baloo font-regular text-nowrap",(i=document.createElement("span")).className="sr-only",i.textContent="Actions",d.appendChild(i),r.appendChild(d)),t.appendChild(r),o.appendChild(t);var i=document.createElement("tbody"),d=(i.className="divide-y divide-gray-200 dark:divide-zinc-700 bg-white dark:bg-zinc-800",o.appendChild(i),l.appendChild(o),document.createElement("div")),t=(d.className="flex justify-between items-center mt-6",document.createElement("p")),o=(t.className="text-sm text-gray-700",document.createElement("div"));o.className="flex gap-2",this.elements={controls:e,searchInput:n,limitSelect:s,tableWrapper:l,tbody:i,pagination:d,recordInfo:t,paginationNav:o},this.container.innerHTML="",this.container.appendChild(e),this.container.appendChild(l),this.container.appendChild(d),d.appendChild(t),d.appendChild(o)}attachEventListeners(){this.elements.searchInput.addEventListener("input",this.debounce(async e=>{this.searchQuery=e.target.value.trim(),this.currentPage=1,await this.loadData(),this.renderTable(),this.renderPagination(),this.updateRecordInfo()},300)),this.elements.limitSelect.addEventListener("change",async e=>{this.currentLimit=parseInt(e.target.value,10),this.currentPage=1,await this.loadData(),this.renderTable(),this.renderPagination(),this.updateRecordInfo()})}debounce(t,a){let n;return(...e)=>{clearTimeout(n),n=setTimeout(()=>t.apply(this,e),a)}}renderTable(){let t=this.elements.tbody;t.innerHTML="",this.data.forEach(n=>{let o=document.createElement("tr");if(this.columnsConfig.forEach((e,t)=>{var a=document.createElement("td"),t=(a.className=`${0===t?"py-3.5 pl-4 pr-3":"py-3.5 px-3"} whitespace-nowrap text-wrap text-base text-gray-700 dark:text-white font-baloo font-regular `+(e.className||""),e.key?this.resolveNestedKey(n,e.key):void 0);e.callback?a.appendChild(e.callback(t,n)):a.textContent=t??"",o.appendChild(a)}),0<this.actionsConfig.length){var e=document.createElement("td");e.className="whitespace-nowrap py-3.5 pl-3 pr-4 text-base text-gray-700 dark:text-white font-baloo font-regular w-56";let a=document.createElement("div");a.className="flex gap-3",this.actionsConfig.forEach(e=>{var t=WsqlElements.button(e.name,e.icon,()=>e.callback(n));a.appendChild(t)}),e.appendChild(a),o.appendChild(e)}t.appendChild(o)})}renderPagination(){var e=this.elements.paginationNav;e.innerHTML="";let t=Math.ceil(this.totalRecords/this.currentLimit);var a=document.createElement("div"),n=(a.className="isolate inline-flex -space-x-px rounded-md shadow-sm",document.createElement("a")),o=(n.className="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 "+(1<this.currentPage?"":"cursor-not-allowed"),document.createElement("span")),l=(o.className="sr-only",o.textContent="Previous",document.createElement("div"));l.className="size-5",l.innerHTML='<svg class="size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd"></path></svg>',n.appendChild(o),n.appendChild(l),a.appendChild(n),n.addEventListener("click",async()=>{1<this.currentPage&&(this.currentPage--,await this.loadData(),this.renderTable(),this.renderPagination(),this.updateRecordInfo())});for(let e=1;e<=t;e++){var s=this.currentPage!==e?"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:outline-offset-0":"z-10 bg-indigo-600 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",r=document.createElement("a");r.className="relative inline-flex items-center px-4 py-2 text-sm font-semibold "+s,r.textContent=e,a.appendChild(r),r.addEventListener("click",async()=>{this.currentPage=e,await this.loadData(),this.renderTable(),this.renderPagination(),this.updateRecordInfo()})}o=document.createElement("a"),o.className="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 "+(this.currentPage<t?"":"cursor-not-allowed"),l=document.createElement("span"),l.className="sr-only",l.textContent="Previous",n=document.createElement("div");n.className="size-5",n.innerHTML='<svg class="size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"></path></svg>',o.appendChild(l),o.appendChild(n),a.appendChild(o),o.addEventListener("click",async()=>{this.currentPage<t&&(this.currentPage++,await this.loadData(),this.renderTable(),this.renderPagination(),this.updateRecordInfo())}),e.appendChild(a)}updateRecordInfo(){var e=this.elements.recordInfo,t=(this.currentPage-1)*this.currentLimit+1,a=Math.min(this.currentPage*this.currentLimit,this.totalRecords),n=(e.innerHTML="",document.createElement("p")),o=(n.className="text-sm text-gray-700",n.appendChild(document.createTextNode("Showing ")),document.createElement("span")),t=(o.className="font-medium",o.textContent=t,n.appendChild(o),n.appendChild(document.createTextNode(" to ")),document.createElement("span")),o=(t.className="font-medium",t.textContent=a,n.appendChild(t),n.appendChild(document.createTextNode(" of ")),document.createElement("span"));o.className="font-medium",o.textContent=this.totalRecords,n.appendChild(o),n.appendChild(document.createTextNode(" records")),e.appendChild(n)}resolveNestedKey(e,t){if(t)return t.split(".").reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}}class WsqlToast{static instance=null;constructor(){return WsqlToast.instance||(this.createToastContainer(),WsqlToast.instance=this),WsqlToast.instance}createToastContainer(){this.container=document.createElement("div"),this.container.id="wsql-toast-container",this.container.className="fixed bottom-8 left-1/2 transform -translate-x-1/2 flex flex-col items-center space-y-4 z-50",document.body.appendChild(this.container)}static show(e,t="info",a=3e3){WsqlToast.instance||new WsqlToast,WsqlToast.instance._show(e,t,a)}_show(e,t="info",a=3e3){let n="",o="";switch(t){case"success":n="bg-green-700",o='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"/></svg>';break;case"info":n="bg-blue-700",o='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c-13.3 0-24 10.7-24 24V264c0 13.3 10.7 24 24 24s24-10.7 24-24V152c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg>';break;case"warning":n="bg-yellow-700",o='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M248.4 84.3c1.6-2.7 4.5-4.3 7.6-4.3s6 1.6 7.6 4.3L461.9 410c1.4 2.3 2.1 4.9 2.1 7.5c0 8-6.5 14.5-14.5 14.5H62.5c-8 0-14.5-6.5-14.5-14.5c0-2.7 .7-5.3 2.1-7.5L248.4 84.3zm-41-25L9.1 385c-6 9.8-9.1 21-9.1 32.5C0 452 28 480 62.5 480h387c34.5 0 62.5-28 62.5-62.5c0-11.5-3.2-22.7-9.1-32.5L304.6 59.3C294.3 42.4 275.9 32 256 32s-38.3 10.4-48.6 27.3zM288 368a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm-8-184c0-13.3-10.7-24-24-24s-24 10.7-24 24v96c0 13.3 10.7 24 24 24s24-10.7 24-24V184z"/></svg>';break;case"danger":n="bg-red-700",o='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM186.3 136.5c-8.6-10.1-23.7-11.4-33.8-2.8s-11.4 23.7-2.8 33.8L224.6 256l-74.9 88.5c-8.6 10.1-7.3 25.3 2.8 33.8s25.3 7.3 33.8-2.8L256 293.2l69.7 82.3c8.6 10.1 23.7 11.4 33.8 2.8s11.4-23.7 2.8-33.8L287.4 256l74.9-88.5c8.6-10.1 7.3-25.3-2.8-33.8s-25.3-7.3-33.8 2.8L256 218.8l-69.7-82.3z"/></svg>'}let l=document.createElement("div");l.className=n+" text-white font-baloo text-md leading-4 px-6 py-4 rounded shadow opacity-0 transition-opacity duration-500 ease-in-out flex space-x-4 items-center max-w-xl w-auto";var t=document.createElement("div"),s=(t.innerHTML=o,t.className="w-5 h-5 fill-white",document.createElement("div")),e=(s.innerText=e,document.createElement("button"));e.className="w-3 h-3 fill-white",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\x3c!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M393.4 41.4c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3L269.3 256 438.6 425.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 301.3 54.6 470.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L178.7 256 9.4 86.6C-3.1 74.1-3.1 53.9 9.4 41.4s32.8-12.5 45.3 0L224 210.7 393.4 41.4z"/></svg>',e.addEventListener("click",()=>{this.hideToast(l)}),l.appendChild(t),l.appendChild(s),l.appendChild(e),this.container.appendChild(l),setTimeout(()=>{l.classList.remove("opacity-0"),l.classList.add("opacity-100")},1),setTimeout(()=>{this.hideToast(l)},a)}hideToast(e){e.classList.remove("opacity-100"),e.classList.add("opacity-0"),setTimeout(()=>{e.parentElement&&this.container.removeChild(e)},500)}}